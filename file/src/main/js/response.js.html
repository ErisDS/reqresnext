<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/main/js/response.js | reqresnext</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Tiny helper for express middleware testing"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="reqresnext"><meta property="twitter:description" content="Tiny helper for express middleware testing"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/antongolub/reqresnext"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#main-js">main/js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/request.js~ReqOptions.html">ReqOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/request.js~Request.html">Request</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/response.js~ResOptions.html">ResOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-gen">gen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-appendAdditionalProps">appendAdditionalProps</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-concat">concat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_COOKIES">DEFAULT_COOKIES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_HEADERS">DEFAULT_HEADERS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_REQ">DEFAULT_REQ</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_STATUS_CODE">DEFAULT_STATUS_CODE</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/main/js/response.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// @flow

import type {
  IAny,
  IApp,
  IData,
  IStatusCode,
  IHeadersMap,
  IRequest,
  IResponse,
  IRawOptions,
  IResponseOpts,
  ICookie,
  ICookiesMap,
  ICookieSetter,
  IHeaderSetter,
  IStatusSetter,
  IDescriptor
} from &apos;./interface&apos;

import express from &apos;express&apos;
import {
  assign,
  each,
  isString,
  isBuffer,
  concat,
  setprototypeof,
  appendAdditionalProps
} from &apos;./util&apos;
import DEFAULT_APP from &apos;./app&apos;

// $FlowFixMe
const { response } = express

type Record&lt;T, V&gt; = {
  [T]: V
}

export const DEFAULT_STATUS_CODE = 200
export const DEFAULT_HEADERS: Record&lt;any, any&gt; = {}
export const DEFAULT_COOKIES: Record&lt;any, any&gt; = {}
export const DEFAULT_REQ: Record&lt;any, any&gt; = {}

export default class Response implements IResponse {
  $key: string

  $value: IAny

  cookie: ICookieSetter

  header: IHeaderSetter

  headers: IHeadersMap

  _headers: IAny

  status: IStatusSetter

  app: IApp

  req: IRequest | Object

  body: IDescriptor

  emit: Function

  write: Function

  end: Function

  constructor (input: ?IRawOptions) {
    setprototypeof(this, response)
    const opts = new ResOptions(input || {})

    let body: IData
    Object.defineProperty(this, &apos;body&apos;, ({
      get () { return body },
      set (value: IData) { throw new Error(&apos;Use .send(), .write() or .json()&apos;) }
    }: Object))

    const write = this.write.bind(this)
    this.write = (chunk: IData, encoding?: ?string, callback?: ?Function): IResponse =&gt; {
      if (isBuffer(chunk)) {
        body = concat(body, chunk.toString(encoding))
      } else if (isString(chunk)) {
        body = concat(body, chunk)
      }
      if (chunk !== undefined) {
        write(chunk, encoding, callback)
      }
      return this
    }
    this.end = (chunk: IData, encoding?: ?string): IResponse =&gt; {
      if (chunk) {
        body = chunk
      }
      this.emit(&apos;finish&apos;)
      return this
    }
    this._headers = null
    this.req = opts.req
    this.app = opts.app
    this.status(opts.statusCode)
    this.header(opts.headers)

    each(opts.cookies, ({ name, value, options }: ICookie): void =&gt; this.cookie(name, value, options))

    // Passes additional props
    appendAdditionalProps(this, opts.raw)
  }
}

export class ResOptions implements IResponseOpts {
  raw: IRawOptions

  statusCode: IStatusCode

  headers: IHeadersMap

  cookies: ICookiesMap

  app: IApp | Object

  req: IRequest | Object

  constructor (input: IRawOptions) {
    this.raw = input
    this.statusCode = ((input.statusCode || input.status || DEFAULT_STATUS_CODE) | 0)
    this.headers = assign({}, DEFAULT_HEADERS, input.headers || {})
    this.cookies = assign({}, DEFAULT_COOKIES, input.cookies || {})
    this.app = input.app || DEFAULT_APP
    this.req = input.req || DEFAULT_REQ
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
