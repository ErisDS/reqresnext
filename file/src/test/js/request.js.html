<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/test/js/request.js | reqresnext</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Tiny helper for express middleware testing"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="reqresnext"><meta property="twitter:description" content="Tiny helper for express middleware testing"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/antongolub/reqresnext"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#main-js">main/js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/request.js~ReqOptions.html">ReqOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/request.js~Request.html">Request</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/response.js~ResOptions.html">ResOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/main/js/response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-gen">gen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-appendAdditionalProps">appendAdditionalProps</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-concat">concat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_COOKIES">DEFAULT_COOKIES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_HEADERS">DEFAULT_HEADERS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_REQ">DEFAULT_REQ</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_STATUS_CODE">DEFAULT_STATUS_CODE</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/test/js/request.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Request from &apos;../../main/js/request&apos;
import { IncomingMessage } from &apos;http&apos;

describe(&apos;request&apos;, () =&gt; {
  describe(&apos;constructor&apos;, () =&gt; {
    it(&apos;returns proper instance&apos;, () =&gt; {
      const req = new Request()

      // NOTE Yes, it&apos;s correct. You can rely on the fact that req.constructor refers to IncomingMessage.
      expect(req).not.toBeInstanceOf(Request)
      expect(req).toBeInstanceOf(IncomingMessage)
    })
  })

  describe(&apos;proto&apos;, () =&gt; {
    describe(&apos;url&apos;, () =&gt; {
      it(&apos;exposes path parts as getters&apos;, () =&gt; {
        const req = new Request({ url: &apos;https://example.com&apos; })

        expect(req.hostname).toBe(&apos;example.com&apos;)
        expect(req.protocol).toBe(&apos;https&apos;)
      })

      it(&apos;opts form has priority&apos;, () =&gt; {
        const req = new Request({ host: &apos;foobar.com&apos;, protocol: &apos;http&apos;, url: &apos;https://example.com&apos; })

        expect(req.path).toBe(&apos;/&apos;)
        expect(req.hostname).toBe(&apos;foobar.com&apos;)
        expect(req.host).toBe(&apos;foobar.com&apos;)
        expect(req.protocol).toBe(&apos;http&apos;)
      })

      it(&apos;attaches default host and protocol values&apos;, () =&gt; {
        const req = new Request({ url: &apos;/example.com&apos; })

        expect(req.url).toBe(&apos;/example.com&apos;)
        expect(req.host).toBe(&apos;localhost&apos;)
        expect(req.protocol).toBe(&apos;http&apos;)
      })
    })

    describe(&apos;headers&apos;, () =&gt; {
      it(&apos;exposes proper getters&apos;, () =&gt; {
        const req = new Request({ headers: { foo: &apos;bar&apos;, baz: &apos;qux&apos; } })

        expect(req.headers.foo).toBe(&apos;bar&apos;)
        expect(req.header(&apos;foo&apos;)).toBe(&apos;bar&apos;)
        expect(req.get(&apos;BAZ&apos;)).toBe(&apos;qux&apos;)
      })
    })

    describe(&apos;ip&apos;, () =&gt; {
      it(&apos;resolves value from headers&apos;, () =&gt; {
        const req = new Request({
          headers: {
            &apos;x-forwarded-for&apos;: &apos;192.168.1.10&apos;
          },
          method: &apos;GET&apos;
        })

        expect(req.ip).toBe(&apos;192.168.1.10&apos;)
      })
    })

    describe(&apos;method&apos;, () =&gt; {
      it(&apos;is passed down&apos;, () =&gt; {
        const req = new Request({
          method: &apos;GET&apos;
        })
        expect(req.method).toBe(&apos;GET&apos;)
      })
    })

    describe(&apos;events&apos;, () =&gt; {
      it(&apos;on&apos;, () =&gt; {
        let foo
        const req = new Request()
        req.on(&apos;data&apos;, () =&gt; {
          foo = &apos;bar&apos;
        })
        req.emit(&apos;data&apos;)

        expect(foo).toBe(&apos;bar&apos;)
      })
    })

    describe(&apos;_flush&apos;, () =&gt; {
      it(&apos;does nothing&apos;, () =&gt; {
        const req = new Request()

        expect(req._flush()).toBeUndefined()
      })
    })
  })
})
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
